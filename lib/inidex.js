/*!
* tMind-Svr v1.0.5
* (c) 2021-2022  Smpoo soft Co. Shanghai China
* Released under the MIT License.
* Author: David
* CreateDate: 2021-03-05
* LastBuild: 2021-08-08 05:09:20
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).tmindSvr=e()}(this,(function(){"use strict";
/*!
	* tMind-Cli v2.3.15
	* (c) 2021-2022  Smpoo soft Co. Shanghai China
	* Released under the MIT License.
	* Author: David
	* CreateDate: 2021-03-05
	* LastBuild: 2021-08-08 02:40:32
	*/const t=["ä¸‡","äº¿","å…†","äº¬","åž“","æ¼","ç©°","æ²Ÿ","æ¶§","æ­£"],e=["é›¶","å£¹","è´°","å","è‚†","ä¼","é™†","æŸ’","æŒ","çŽ–"],r=["å…ƒ","æ‹¾","ä½°","ä»Ÿ","ä¸‡","æ‹¾","ä½°","ä»Ÿ","äº¿","æ‹¾","ä½°","ä»Ÿ","å…†","æ‹¾","ä½°","ä»Ÿ","äº¬","æ‹¾","ä½°","ä»Ÿ","åž“","æ‹¾","ä½°","ä»Ÿ","æ¼","æ‹¾","ä½°","ä»Ÿ","ç©°","æ‹¾","ä½°","ä»Ÿ","æ²Ÿ","æ‹¾","ä½°","ä»Ÿ","æ¶§","æ‹¾","ä½°","ä»Ÿ","æ­£","æ‹¾","ä½°","ä»Ÿ"],n=function(t,e){return Intl.NumberFormat("cmn-Hans-CN",{style:"currency",currency:e}).format(t)},o=function(t,e){return Intl.NumberFormat("en-US",{maximumFractionDigits:void 0===e?2:e}).format(2334.338922)},i=function(t){return`${t}`.split(".")},s=function(t,e,r){const n=e??2;switch(r??"normal"){case"bank":return+t.toFixed(n);case"carry":return+`${t}`.split(".")[0]+1;case"drop":return+`${t}`.split(".")[0];default:const e=10**n,[r,o]=(""+t*e).split(".");let i=+r;return o&&+o.slice(0,1)>4&&(i+=1),i/e}},c=function(n){const o=["è§’","åˆ†","åŽ˜","æ¯«","ä¸"],[i,s]=`${n}`.split(".");if(i.length>r.length)return"é‡‘é¢è¶…å‡ºæœ‰æ•ˆèŒƒå›´ï¼Œæ— æ³•æ˜¾ç¤ºå¤§å†™";const c=[],a=[];if(i.split("").reverse().forEach(((n,o)=>{const i=r[o],s=`${e[+n]}${"0"!==n||t.includes(i)?i:""}`;c.push(s)})),s&&s.length){const t=s.split("").slice(0,o.length),r=[];t.forEach(((t,n)=>{r.push(`${e[+t]}${o[n]}`)})),a.push(r.join(""))}else a.push("æ•´");return[c.reverse().join("").replace(new RegExp(t.map((t=>`(é›¶+${t})`)).join("|"),"g"),(t=>t.replace(/é›¶+/g,""))).replace(/é›¶+/g,"é›¶"),a.join("")].join("")},a=function(t){return!(0==(1&t))};var u;function p(t,e,...r){if(e){if(e===t.length)t.push(...r);else if(e>0){const n=t.splice(0,e);t.unshift(...r),t.unshift(...n)}}else t.unshift(...r)}function l(t,e,r,n,o){if(function(t){return`${Object.prototype.toString.call(t).replace(/\[object\s|\]/g,"").toLowerCase()}`}(t[0])===u.object)e>r?function(t,e,r,n,o){const[i,s]=[r,e],[c,a]=[e,e+n];for(let e=i;e<s;e++){const r=t[e];r[o]=(+r[o]||e)+n}for(let n=c;n<a;n++){const i=t[n];i[o]=(+i[o]||n)-(e-r)}}(t,e,r,n,o):e<r&&function(t,e,r,n,o){const[i,s]=[e,e+n],[c,a]=[e+n,r+n],u=r-e;for(let e=i;e<s;e++){const r=t[e];r[o]=(r[o]||e)+u}for(let e=c;e<a;e++){const r=t[e],i=(r[o]||e)-n;r[o]=i}}(t,e,r,n,o);else{const o=t.splice(e,n);e<r?p(t,r-n,...o):e>r&&p(t,r,...o)}}!function(t){t.arguments="arguments",t.array="array",t.arraybuffer="arraybuffer",t.boolean="boolean",t.date="date",t.dataview="dataview",t.error="error",t.float32array="float32array",t.float64array="float64array",t.function="function",t.int16array="int16array",t.int32array="int32array",t.int8array="int8array",t.map="map",t.number="number",t.object="object",t.regexp="regexp",t.set="set",t.string="string",t.symbol="symbol",t.uint16array="uint16array",t.uint32array="uint32array",t.uint8array="uint8array",t.uint8clampedarray="uint8clampedarray",t.weakmap="weakmap",t.weakref="weakref",t.weakset="weakset"}(u||(u={}));const f=t=>t.split("").map((t=>t.charCodeAt(0))),h=(t,e)=>String.fromCharCode(...Array.isArray(t)?t:t.split(e||"-").map((t=>+t))),m={toUniCode:f,wechatNick:function(t){return f(t).join("-")}},y={toStr:h,wechatNick:function(t){return h(t,"-")}};class g{}g.inBrowser=!!globalThis.window,g.inSvr=!!globalThis.process,g.NUM_TO_STR=["é›¶","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹","å"],g.sort={sortASC:function(t,e){return"string"==typeof t?t.localeCompare(`${e}`):"number"==typeof t&&"number"==typeof e?t-e:0},sortDESC:function(t,e){return"string"==typeof t?`${e}`.localeCompare(t):"number"==typeof t&&"number"==typeof e?e-t:0}},g.encode=m,g.decode=y;const d=["[30m","[39m"],b=["[34m","[39m"],N=["[32m","[39m"],S=["[33m","[39m"],$=["[31m","[39m"],w=["[44m","[49m"],v=["[104m","[49m"],C=["[42;30m","[49m"],O=["[102m","[49m"],R=["[43;30m","[49m"],j=["[103m","[49m"],k=["[41m","[49m"],A=["[105m","[49m"],E=["[0m"],x={INFO:["ä¿¡æ¯",w[0],w[1],b[0],b[1],E[0]],SUCC:["æˆåŠŸ",C[0],C[1],N[0],N[1],E[0]],WARN:["è­¦å‘Š",R[0],R[1],S[0],S[1],E[0]],ERR:["é”™è¯¯",k[0],k[1],$[0],$[1],E[0]]},T={INFO:["ä¿¡æ¯",v[0],v[1],d[0],d[1]],SUCC:["æˆåŠŸ",O[0],O[1],d[0],d[1]],WARN:["è­¦å‘Š",j[0],j[1],d[0],d[1]],ERR:["é”™è¯¯",A[0],A[1],$[0],$[1]]};function F(t,e,r){const n=`${r}`.toUpperCase(),o=(t,e)=>t(e),i=typeof t,[s,c,a,u,p]=g.inBrowser?T[n]||["","","","",""]:x[n]||["","","","",""];if("string"===i){const n=`${c} ${e||s} ${a} ${u} ${t} ${p}`;o(r&&("ERR"===r&&console.error||"WARN"===r&&console.warn||console.log)||console.log,n)}else t instanceof Error?o(console.error,`${c} ${e||s} ${a} ${u} ${t} ${p}`):"object"===i&&console.log(JSON.stringify(t),null,2)}String.prototype.len=function(){return this.length},String.prototype.lenfrom0=function(){return this.length,this.length-1},String.prototype.left=function(t){return(this||"").slice(0,t)},String.prototype.right=function(t){return(this||"").slice(-1*t)},String.prototype.mid=function(t,e){return e>0?(this||"").slice(t,t+e):e<0?(this||"").slice(t,e):""},String.prototype.like=function(t){return"num2"===t?/^[0-1]*$/.test(`${this}`):"num8"===t?/^[0-7]*$/.test(`${this}`):"num16"===t?/^[0-9a-fA-F]*$/.test(`${this}`):"num26"===t?/^[a-zA-Z]*$/.test(`${this}`):/^[0-9]*$/.test(`${this}`)},String.prototype.upFirst=function(){return this.replace(/^(\w)/,((t,e)=>t.toUpperCase()))},String.prototype.camelCase=function(){return this.replace(/[-|_|\s+](\w)/g,((t,e)=>e.toUpperCase()))},String.prototype.toObj=function(){const t=this;if(!t)return{gotNull:"The original paramter shouldn't be a empty string."};try{return JSON.parse(t)}catch(t){return{gotWrong:"The original paramter isn't a correct json like string."}}},String.prototype.encodeToUniCode=function(){return m.toUniCode(this.valueOf())},String.prototype.encodeFromWechatNick=function(){return m.wechatNick(this.valueOf())},String.prototype.decodeToStr=function(t){return y.toStr(this.valueOf(),t||"-")},String.prototype.decodeToWechatNick=function(){return y.wechatNick(this.valueOf())},Number.prototype.toPrice=function(t="CNY"){return n.call(this,this.valueOf(),t)},Number.prototype.toSplit=function(t){return o.call(this,this.valueOf(),t)},Number.prototype.toArr=function(){return i.call(this,this.valueOf())},Number.prototype.toRound=function(t,e){return s.call(this,this.valueOf(),t,e)},Number.prototype.toCNY=function(){return c.call(this,this.valueOf())},Number.prototype.isOdd=function(){return a.call(this,this.valueOf())},Number.prototype.funcAdd=function(...t){return((...t)=>{try{return t.reduce(((t,e)=>t+1e6*+e),0)/1e6}catch(t){return NaN}})(this.valueOf(),...t)},Number.prototype.funcSub=function(...t){return((...t)=>{try{const[e,...r]=t;return r.reduce(((t,e)=>t-1e6*+e),1e6*+e)/1e6}catch(t){return NaN}})(this.valueOf(),...t)},Number.prototype.funcMult=function(...t){return((...t)=>{try{return t.reduce(((t,e)=>t*+e*1e6),1)/1e6**t.length}catch(t){return NaN}})(this.valueOf(),...t)},Number.prototype.funcDiv=function(...t){return((...t)=>{try{const[e,...r]=t;return r.includes(0)?NaN:r.reduce(((t,e)=>t/(1e6*e)),1e6*+e)}catch(t){return NaN}})(this.valueOf(),...t)},Array.prototype.insertTo=function(t=1,...e){p.call(this,this,t,...e)},Array.prototype.moveTo=function(t,e,r=1,n="orderIdx"){l.call(this,this,t,e,r,n)},Array.prototype.decodeToStr=function(){return y.toStr(this,"")};const q=g;q.inBrowser?(console.clear(),console.log(String.fromCharCode(..."32-32-32-32-32-32-95-95-95-32-32-32-32-32-32-32-32-32-32-32-95-95-95-32-32-32-32-32-32-32-32-32-32-32-95-95-95-32-32-32-32-32-32-32-32-32-32-32-95-95-95-32-32-32-32-32-32-32-32-32-32-32-95-95-95-32-32-32-32-32-10-32-32-32-32-32-47-92-32-32-92-32-32-32-32-32-32-32-32-32-47-92-95-95-92-32-32-32-32-32-32-32-32-32-47-92-32-32-92-32-32-32-32-32-32-32-32-32-47-92-32-32-92-32-32-32-32-32-32-32-32-32-47-92-32-32-92-32-32-32-32-10-32-32-32-32-47-58-58-92-32-32-92-32-32-32-32-32-32-32-47-58-58-124-32-32-124-32-32-32-32-32-32-32-47-58-58-92-32-32-92-32-32-32-32-32-32-32-47-58-58-92-32-32-92-32-32-32-32-32-32-32-47-58-58-92-32-32-92-32-32-32-10-32-32-32-47-58-47-92-32-92-32-32-92-32-32-32-32-32-47-58-124-58-124-32-32-124-32-32-32-32-32-32-47-58-47-92-58-92-32-32-92-32-32-32-32-32-47-58-47-92-58-92-32-32-92-32-32-32-32-32-47-58-47-92-58-92-32-32-92-32-32-10-32-32-95-92-58-92-45-92-32-92-32-32-92-32-32-32-47-58-47-124-58-124-95-95-124-95-95-32-32-32-47-58-58-92-45-92-58-92-32-32-92-32-32-32-47-58-47-32-32-92-58-92-32-32-92-32-32-32-47-58-47-32-32-92-58-92-32-32-92-32-10-32-47-92-32-92-58-92-32-92-32-92-95-95-92-32-47-58-47-32-124-58-58-58-58-92-95-95-92-32-47-58-47-92-58-92-32-92-58-92-95-95-92-32-47-58-47-95-95-47-32-92-58-92-95-95-92-32-47-58-47-95-95-47-32-92-58-92-95-95-92-32-10-32-92-58-92-32-92-58-92-32-92-47-95-95-47-32-92-47-95-95-47-45-45-47-58-47-32-32-47-32-92-47-95-95-92-58-92-47-58-47-32-32-47-32-92-58-92-32-32-92-32-47-58-47-32-32-47-32-92-58-92-32-32-92-32-47-58-47-32-32-47-32-10-32-32-92-58-92-32-92-58-92-95-95-92-32-32-32-32-32-32-32-32-32-47-58-47-32-32-47-32-32-32-32-32-32-32-92-58-58-47-32-32-47-32-32-32-92-58-92-32-32-47-58-47-32-32-47-32-32-32-92-58-92-32-32-47-58-47-32-32-47-32-10-32-32-32-92-58-92-47-58-47-32-32-47-32-32-32-32-32-32-32-32-47-58-47-32-32-47-32-32-32-32-32-32-32-32-32-92-47-95-95-47-32-32-32-32-32-92-58-92-47-58-47-32-32-47-32-32-32-32-32-92-58-92-47-58-47-32-32-47-32-32-10-32-32-32-32-92-58-58-47-32-32-47-32-32-32-32-32-32-32-32-47-58-47-32-32-47-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-92-58-58-47-32-32-47-32-32-32-32-32-32-32-92-58-58-47-32-32-47-32-32-32-10-32-32-32-32-32-92-47-95-95-47-32-32-32-32-32-32-32-32-32-92-47-95-95-47-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-92-47-95-95-47-32-32-32-32-32-32-32-32-32-92-47-95-95-47-32-32-32-32-10-10-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-32-19978-28023-28145-26222-36719-20214-26377-38480-20844-21496-32-45-32-119-119-119-46-115-109-112-111-111-46-99-111-109".split("-").map((t=>+t)))),window.onerror=function(t,e,r){return!1}):q.inSvr&&process.on("uncaughtException",(function(t){F(t,"æœªå¤„ç†çš„å¼‚å¸¸","ERR")}));const U=F;class M extends Error{constructor(t,e,r){super("string"==typeof t?t:t.message);const n="boolean"==typeof e;this.code=e?n?1e4:e:1e4,(n||r)&&U("string"==typeof t?t:t.message,"å¼‚å¸¸","ERR")}}const W=require("events"),P=require("./PathMgr"),I=require("./preConf"),D=require("./bootWelcome"),H=require("request-promise");class z extends W{constructor(t){super(),this.#pathMgr=new P(t),this.#ident=this.#pathMgr.svrForlder,this.#config=I(this.#pathMgr),this.#isPause=!1,this.#isHttps=!!this.#config.cert.key,this.on("error",(t=>{this.echo("ç›‘å¬åˆ°å¼‚å¸¸ï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼š","é”™è¯¯","ERR"),this.echo(t)}))}#ident;#pathMgr;#config;#isPause;#isHttps;get pathMgr(){return this.#pathMgr||{}}get config(){return this.#config.unit[this.#ident]||{}}get configAll(){return this.#config||{}}get status(){return this.#isPause}echo(t,e,r){const n=t instanceof Error;e?U(t,e,r):n?console.error(t):console.log(t)}start(){try{D(this.#isHttps,this.config.port,this.config.namezh)}catch(t){this.echo(t.message,"å¯åŠ¨å¤±è´¥"),this.echo(t),process.exit(1)}}stop(t){U(t||"å·²åœæ­¢æœåŠ¡ç«¯","æ‰‹åŠ¨","WARN"),process.exit(0)}pause(){this.#isPause=!0,this.echo("æœåŠ¡å·²æš‚åœ","è­¦å‘Šï¼","WARN")}resume(){this.#isPause=!1,this.echo("æœåŠ¡å·²æ¢å¤","ä¿¡æ¯","INFO")}exit(t,e){U(t||`[${this.config.namezh}]æœåŠ¡ç«¯æ— æ³•å¯åŠ¨`,"å¯åŠ¨å¼‚å¸¸","ERR"),process.exit(e??1)}async http(t,e){const r="string"==typeof t,n=e&&"object"!=typeof e,o={uri:r&&t||t.uri,json:!0},i=!r&&t?.qs||!n&&e?.qs,s=!r&&t?.headers||!n&&e?.headers,c=n&&e||!r&&t?.method||"GET";i&&(o.qs=i),s&&(o.headers=s),c&&"GET"!==c&&(o.method=c);try{return await H(o)}catch(t){this.emit("error",new M(t,10005,!0))}}}const B=require("koa");return{KoaSvr:class extends z{constructor(t){super(t),this.#app=new B,this.#app.use((async(t,e)=>{t.body="æµ‹è¯•",await e()}))}#app;start(){this.#app.listen(super.config.port),super.start()}},DbSvr:class{}}}));
